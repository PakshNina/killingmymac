# Killing My Mac

Проект для тестирования поведения сборщика мусора на стеке.

## Описание

- `initial/main.go` - изначальный код, порождающий утечку памяти в  Go < 1.12
- `withstat/main.go` - расширенная версия с мониторингом памяти
- `recomendation/` - сравнение множества объектов стека vs один массив с бенчмарками и метриками GC

## Тестирование утечки памяти
Протестировать утечку можно запустив код в контейнере с версией Go 1.9.1:

### С помощью Make

Собрать Docker образ с Go 1.9.1:

```bash
make build19
```

Запустить контейнер с Go 1.9.1:

```bash
make run19
```

### С помощью команды docker:

Собрать образ с Go 1.9.1:

```bash
docker build --build-arg GO_VERSION=1.9.1 -t kill-app -f Dockerfile .
```

Запустить контейнер с Go 1.9.1 (с ограничением памяти):

```bash
docker run --rm -p 8080:8080 --memory=500m kill-app
```

## Код без утечки памяти:

### С помощью Make

Собрать Docker образ с Go 1.24.1:

```bash
make build124
```

Запустить контейнер с Go 1.24.1:

```bash
make run124
```

### С помощью команды docker:
Собрать образ с Go 1.24.1:

```bash
docker build --build-arg GO_VERSION=1.24.1 -t normal-app -f Dockerfile .
```

Запустить контейнер с Go 1.24.1 (с ограничением памяти):

```bash
docker run --rm -p 8080:8080 --memory=500m normal-app
```

## Бенчмарки для примера с оптимизацией

Запустить бенчмарки для примера оптимизации:

```bash
make benchmark
```

Или напрямую через go test:

```bash
go test -bench=. -benchtime=50000x ./recomendation/
```

### Метрики GC в бенчмарках

Бенчмарки автоматически собирают метрики GC через `runtime/metrics`:

- **gc-total-s** - общее время CPU, потраченное на выполнение задач GC
