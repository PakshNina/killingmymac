# Killing My Mac

Проект для тестирования поведения сборщика мусора и управления памятью в разных версиях Go.

## Описание

Проект содержит две версии программы, которые создают связанный список узлов в памяти для демонстрации работы сборщика мусора Go:

- `initial/main.go` - простая версия, создающая бесконечный связанный список без контроля памяти
- `withstat/main.go` - расширенная версия с мониторингом памяти, pprof сервером и автоматической остановкой при превышении лимита памяти

## Структура проекта

```
.
├── Dockerfile        # Единый Dockerfile с поддержкой разных версий Go
├── Makefile          # Команды для сборки и запуска
├── go.mod            # Go модуль
├── initial/          # Простая версия программы
│   └── main.go
└── withstat/         # Версия с мониторингом памяти
    └── main.go
```

## Требования

- Docker
- Make (опционально)

## Использование

### С помощью Make

Собрать Docker образ с Go 1.9.7:

```bash
make build19
```

Собрать и запустить контейнер с Go 1.9.7 (с ограничением памяти 500MB):

```bash
make run19
```

Собрать Docker образ с Go 1.12.1:

```bash
make build112
```

Собрать и запустить контейнер с Go 1.12.1 (с ограничением памяти 500MB):

```bash
make run112
```

Удалить все Docker образы:

```bash
make clean
```

### Без Make

Собрать образ с Go 1.9.7:

```bash
docker build -t kill-app --build-arg GO_VERSION=1.9.7 -f Dockerfile .
```

Запустить контейнер с Go 1.9.7 (с ограничением памяти):

```bash
docker run --rm -p 8080:8080 --memory=500m kill-app
```

Собрать образ с Go 1.12.1:

```bash
docker build -t normal-app --build-arg GO_VERSION=1.12.1 -f Dockerfile .
```

Запустить контейнер с Go 1.12.1 (с ограничением памяти):

```bash
docker run --rm -p 8080:8080 --memory=500m normal-app
```

## Мониторинг

При запуске версии `withstat/main.go` программа:

- Запускает pprof сервер на порту 8080
- Выводит статистику памяти каждые 1000000 созданных узлов
- Останавливается при превышении лимита в 1000MB памяти в куче
- Показывает количество сборок мусора

Для доступа к pprof интерфейсу откройте в браузере:

```
http://localhost:8080/debug/pprof/
```

## Ограничение памяти

По умолчанию контейнеры запускаются с ограничением памяти 500MB. Это позволяет:

- Тестировать поведение программы при ограниченных ресурсах
- Наблюдать работу сборщика мусора под давлением памяти
- Предотвращать исчерпание памяти на хосте

При превышении лимита Docker может остановить контейнер (OOM kill).

